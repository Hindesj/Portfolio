"use strict";(()=>{var J=Object.defineProperty;var a=(w,E)=>J(w,"name",{value:E,configurable:!0});(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[716],{60716:(w,E,l)=>{l.d(E,{i:()=>_});var p=l(59753),x=l(84570),R=l(69567),C=l(46263),S=l(64463),N=l(10900);(0,S.N7)(".js-add-secret-format-button",{add(){window.postProcessingExpressionCount=0;const e=document.querySelector(".js-post-processing-expression-count");e&&e.textContent&&(window.postProcessingExpressionCount=parseInt(e.textContent))}}),(0,p.on)("click",".js-add-secret-format-button",e=>{const t=e.currentTarget;if(!!t&&window.postProcessingExpressionCount<h()){const n=document.querySelectorAll(".js-additional-secret-format");if(!n)return;for(const o of n)if(o.classList.contains("has-removed-contents")){o.classList.toggle("has-removed-contents",!1),window.postProcessingExpressionCount++,window.postProcessingExpressionCount===h()&&(t.hidden=!0);break}}}),(0,p.on)("click",".js-remove-secret-format-button",e=>{var t,n;const o=document.querySelector(".js-add-secret-format-button");if(!o)return;const s=e.currentTarget;if(!s)return;const r=s.closest(".js-additional-secret-format");if(!r)return;r.classList.toggle("has-removed-contents",!0);const i=r.getElementsByClassName("js-post-processing-input")[0];i.value="";const u=Array.from(r.getElementsByClassName("js-post-processing-input-rule")),c=r.getElementsByClassName("errored")[0];c&&c.classList.toggle("errored",!1);for(const d of u)(t=document.getElementById(`${d.id}_hidden`))==null||t.remove();(n=document.getElementById(`${i.id}_hidden`))==null||n.remove(),v(window.codeEditor.getValue()),window.postProcessingExpressionCount--,window.postProcessingExpressionCount<h()&&(o.hidden=!1)}),(0,S.N7)(".js-test-code",{async add(){const e=document.querySelector(".js-test-code"),t=e.clientHeight,n=await l.e(4631).then(l.t.bind(l,4631,23));if(window.codeEditor=n.default.fromTextArea(e,{lineNumbers:!1,lineWrapping:!0,mode:"text/x-yaml",inputStyle:"contenteditable",value:e.value,lineSeparator:`\r
`,theme:"github-light"}),t!==0){const r=document.querySelector(".CodeMirror");r&&(r.style.height=`${t}px`,r.style.border="1px solid #e1e4e8",r.style.borderRadius="6px")}window.codeEditor.save();const o=document.querySelector(".js-test-custom-secret-scanning-pattern");if(!o)return;let s=v;o.hasAttribute("data-source-is-readonly")&&(s=W),window.codeEditor.on("change",()=>{s(window.codeEditor.getValue())})}}),(0,x.q6)(".js-custom-secret-scanning-pattern-form *",async function(){!window.codeEditor||v(window.codeEditor.getValue())}),(0,p.on)("click",".js-repo-selector-dialog-summary-button.disabled",e=>{e.preventDefault()}),(0,p.on)("click",".js-save-and-dry-run-button, .js-custom-pattern-submit-button, .js-org-repo-selector-dialog-dry-run-button",e=>{e.preventDefault();const t=F(e);if(!t)return;O(t);const n=T();!n||((t.className.includes("js-save-and-dry-run-button")||t.className.includes("js-org-repo-selector-dialog-dry-run-button"))&&j(n,"submit_type","save_and_dry_run"),(0,p.f)(n,"submit"))});function F(e){return e.currentTarget}a(F,"getSubmitButton");function O(e){e.innerHTML=e.getAttribute("data-disable-with")||"",e.disabled=!0}a(O,"setSubmitButtonDisableWith");function T(){return document.querySelector(".js-custom-secret-scanning-pattern-form")}a(T,"getCustomPatternForm");const j=a((e,t,n)=>{const o=document.createElement("input");o.type="hidden",o.name=t,o.id=`${t}_hidden`,o.value=n,e.appendChild(o),o.required=!0},"createHiddenInputField"),v=(0,C.D)(function(e){const t=document.querySelector(".js-custom-pattern-submit-button"),n=document.querySelector(".js-save-and-dry-run-button"),o=document.querySelector(".js-repo-selector-dialog-summary-button"),s=document.querySelector(".js-update-pattern-info"),r=document.querySelector(".js-test-pattern-matches");if(!!r)if(e.length===0){const i=document.querySelector(".js-dry-run-status");if(!i)return;U(i)||t==null||t.setAttribute("disabled","true"),n==null||n.setAttribute("disabled","true"),o==null||o.classList.add("disabled"),r.textContent=""}else{window.codeEditor.save();const i=document.querySelector(".js-test-custom-secret-scanning-pattern");if(!(i instanceof HTMLFormElement))return;const u=T();if(!u)return;for(const c of u.elements)if(c instanceof HTMLInputElement&&c.name&&(c.type==="text"||c.type==="radio"&&c.checked)){const d=document.getElementById(`${c.name}_hidden`);d!==null&&d.remove(),j(i,c.name,c.value)}D(i,q(u,t,n,o,s),I(r))}},300),I=a(e=>t=>{if(t.length===0)e.textContent=" - No matches";else if(t.length===1)e.textContent=" - 1 match";else{const n=[];for(const r of t)n.push(JSON.stringify(r));const s=[...new Set(n)];e.textContent=` - ${s.length} matches`}},"getTestLabelUpdater"),q=a((e,t,n,o,s)=>r=>{var i,u,c;if(k(e),r==null?void 0:r.message){if(t==null||t.setAttribute("disabled","true"),n==null||n.setAttribute("disabled","true"),o==null||o.classList.add("disabled"),s)s.hidden=!0;else if((r==null?void 0:r.error_type)==="START_DELIMITER"||(r==null?void 0:r.error_type)==="END_DELIMITER"||(r==null?void 0:r.error_type)==="MUST_MATCH"||(r==null?void 0:r.error_type)==="MUST_NOT_MATCH"){const d=document.querySelector(".js-more-options.js-details-container");d&&(d.classList.add("open"),d.classList.add("Details--on"))}return B(e,r),!1}else{const d=document.querySelector(".js-mode");if(!d)return!1;const m=document.querySelector(".js-dry-run-status");return m?((((i=m.textContent)==null?void 0:i.toLowerCase())==="cancelled"||((u=m.textContent)==null?void 0:u.toLowerCase())==="skipped"||((c=d.textContent)==null?void 0:c.toLowerCase())!=="unpublished")&&(t==null||t.removeAttribute("disabled")),o==null||o.classList.remove("disabled"),n==null||n.removeAttribute("disabled"),s&&(s.hidden=!1),!0):!1}},"getTestErrorHandler");function B(e,t){var n;if(t.error_type==="MUST_MATCH"||t.error_type==="MUST_NOT_MATCH"){let o=0;const s=e.getElementsByClassName("js-additional-secret-format");for(const r of s){if(o>(t.error_index||0))return;const u=[...r.getElementsByTagName("input")].filter(y=>y.checked),c=u&&((n=u[0])==null?void 0:n.value.toUpperCase()),d=c===t.error_type&&o===t.error_index,b=[...r.getElementsByTagName("input")].filter(y=>y.type==="text");if(!b||b.length===0)continue;const f=b[0];if(f.value!=="")if(d){const y=f.id;f&&f.parentElement&&A(f.parentElement);const g=document.createElement("p"),P=`${y}_error_message`;g.classList.add("note","error","mt-5"),g.id=P,g.textContent=t.message,f==null||f.setAttribute("aria-describedby",P),f==null||f.insertAdjacentElement("afterend",g);return}else c===t.error_type&&o++}}else{const o=$[t.error_type],s=document.querySelector(`#${o}`);s&&s.parentElement&&A(s.parentElement);const r=document.createElement("p"),i=`${o}_error_message`;r.classList.add("note","error"),r.id=i,r.textContent=t.message,s==null||s.setAttribute("aria-describedby",i),s==null||s.insertAdjacentElement("afterend",r)}}a(B,"showInputErrorState");function k(e){var t,n;const o=document.querySelector(".js-error-banner");o.hidden=!0;for(const s of e.getElementsByTagName("input"))if((t=s.parentElement)==null?void 0:t.classList.contains("errored")){H(s.parentElement);const r=s.getAttribute("aria-describedby");(n=document.querySelector(`#${r}`))==null||n.remove()}}a(k,"clearInputErrorState");function h(){const e=document.querySelector(".js-post-processing-expression-max-count");if(!e)return 5;const t=e.textContent;return t?parseInt(t):5}a(h,"getMaxPostProcessingExpressions");function A(e){e==null||e.classList.add("form-group","errored","my-0")}a(A,"addErrorStylingToInput");function H(e){e==null||e.classList.remove("form-group","errored","my-0")}a(H,"removeErrorStylingFromInput");function M(){if(!window.codeEditor)return;const e=window.codeEditor.posFromIndex(0),t=window.codeEditor.posFromIndex(window.codeEditor.getValue().length);for(const n of window.codeEditor.findMarks(e,t))n.clear()}a(M,"clearCodeHighlights");function U(e){var t,n;return((t=e.textContent)==null?void 0:t.toLowerCase())==="queued"||((n=e.textContent)==null?void 0:n.toLowerCase())==="inprogress"}a(U,"allowDryRunCancellation");const $={NONE:"",CONFIG_LOAD:"secret_format",COMPILE_DB:"secret_format",START_DELIMITER:"before_secret",END_DELIMITER:"after_secret",DISPLAY_NAME:"display_name"};async function D(e,t,n){let o;try{const s=await fetch(e.action,{method:e.method,body:new FormData(e),headers:{Accept:"application/json"}});s.ok&&(o=await s.json())}catch{}if(o&&t(o.error))if(o.has_matches){const s=JSON.parse(o.matches);M(),n(s);const r=document.querySelector(".js-test-code");for(const i of s)z(window.codeEditor,r,i.start,i.end)}else n([]),M()}a(D,"updatePatternMatches");const W=(0,C.D)(function(e){const t=document.querySelector(".js-test-custom-secret-scanning-pattern");if(!(t instanceof HTMLFormElement))return;const n=document.querySelector(".js-test-pattern-matches");if(!!n)if(e.length===0)n.textContent="";else{if(!window.codeEditor)return;window.codeEditor.save(),D(t,()=>!0,I(n))}},300);function z(e,t,n,o){if(n=_(t.value,n),o=_(t.value,o),n===-1||o===-1)return;const s=e.posFromIndex(n),r=e.posFromIndex(o);e.markText(s,r,{className:"text-bold hx_keyword-hl rounded-2 d-inline-block"})}a(z,"MarkMatch");function _(e,t){const n=[...e],o=new TextEncoder,s=new Uint8Array(4);for(let r=0;r<n.length;r++){const i=n[r],{written:u,read:c}=o.encodeInto(i,s);if(!u||!c)return-1;const d=u-c;if(d!==0&&(r<t&&(t-=d),r>=t))break}return t}a(_,"GetByteOffset");async function K(e){const t=e.currentTarget;e.preventDefault(),L(t,parseInt(t.remove_repo_id.value),!1)}a(K,"removeDryRunRepo");async function L(e,t,n){const o=document.getElementById("selected_repo_ids");if(!o)return;const s=document.querySelector(".js-org-repo-selector-dialog-dry-run-button");if(!s)return;const r=JSON.parse(o.value),i=new Set(r);n?i.size<V()&&i.add(t):i.delete(t),o.value=JSON.stringify(Array.from(i)),i.size>0?s.removeAttribute("disabled"):s.setAttribute("disabled","true");const u=new FormData(e);u.append("selected_repo_ids",o.value);const c=await fetch(e.action,{method:e.method,body:u,headers:{Accept:"text/fragment+html"}});if(c.status>=400){const d="An unknown error occurred.",m=document.querySelector("template.js-flash-template");m.after(new R.R(m,{className:"flash-error",message:d}))}else{const d=document.querySelector(".js-dry-run-selected-repos"),m=(0,N.r)(document,await c.text());d.replaceWith(m)}}a(L,"updateDryRunSelectedRepos"),(0,p.on)("click",".js-remove-dry-run-repo-form",K),(0,p.on)("auto-complete-change",".js-dry-run-repo-autocomplete",function(e){const t=e.target;if(!t.value)return;if(t.value.includes("No repositories found.")){t.value="";return}const n=t.closest("form");L(n,parseInt(n.repo_id.value),!0),t.value=""}),(0,x.w4)("keydown",".js-dry-run-repo-autocomplete-input",function(e){e.key==="Enter"&&e.preventDefault()});function V(){const e=document.querySelector(".js-dry-run-selected-repos-max-count");if(!e)return 10;const t=e.textContent;return t?parseInt(t):10}a(V,"getMaxDryRunSelectedRepos")}}]);})();

//# sourceMappingURL=716-95c0b5cea7f1.js.map